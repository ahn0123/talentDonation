<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.talentDonation.mapper.ReviewMapper">
	
	<!-- 검색 조건문(리뷰현황) -->
    <sql id="criteria_review">
        <if test="type != null and keyword != null">
            <trim prefix="where" suffix="" prefixOverrides="OR">
                <foreach item="type" collection="typeArr">
                    <trim prefix="OR">
                        <choose>
                        	<when test="type == 'P'.toString()">
                                prog_title LIKE '%'|| #{keyword} ||'%'
                            </when>
                            <when test="type == 'T'.toString()">
                                rev_title LIKE '%'|| #{keyword} ||'%'
                            </when>
                            <when test="type == 'I'.toString()">
                                dog_mem_id LIKE '%'|| #{keyword} ||'%'
                            </when>                            
                        </choose>
                    </trim>
                </foreach>
            </trim>
        </if>
    </sql>
    
	<!-- 리뷰정보 가져오기 -->
    <select id="getReviewList" parameterType="list" resultType="com.talentDonation.dto.Review">
        select * from (select rownum as rn, r.*, p.prog_title, d.dog_mem_id 
        from review r join program p on r.rev_prog_id = p.prog_id join dog d on r.rev_dog_id = d.dog_id
        <if test="keyword != null">
           <include refid="criteria_review"></include>
        </if>        
        ) T1
        where rn between ((nvl(#{pageNum},0)-1)*#{amount})+1 and (nvl(#{pageNum},0)*#{amount})   
    </select>
    
    <!-- 리뷰 총 개수 -->
    <select id="getReviewTotal" resultType="int">
        select count(*) from (select rownum as rn, r.*, p.prog_title, d.dog_mem_id 
        from review r join program p on r.rev_prog_id = p.prog_id join dog d on r.rev_dog_id = d.dog_id)
        <if test="keyword != null">
            <include refid="criteria_review"></include>
        </if>
    </select>
	
</mapper>